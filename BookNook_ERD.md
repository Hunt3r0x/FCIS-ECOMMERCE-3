# مخطط ERD لقاعدة بيانات BookNook

```
+----------------+       +----------------+       +----------------+
|     users      |       |      cart      |       |     books      |
+----------------+       +----------------+       +----------------+
| PK id          |       | PK id          |       | PK id          |
| username       |       | FK user_id     |------>| title          |
| password       |       | FK book_id     |------>| author         |
| is_admin       |       |                |       | price          |
+----------------+       +----------------+       | cover_url      |
       |                                          +----------------+
       |                                                  ^
       |                                                  |
       v                                                  |
+----------------+       +----------------+               |
|     orders     |       |  order_items   |               |
+----------------+       +----------------+               |
| PK id          |       | PK id          |               |
| FK user_id     |<------| FK order_id    |               |
| order_date     |       | FK book_id     |---------------+
| total_amount   |       | quantity       |
| status         |       | price          |
+----------------+       +----------------+
```

## تفاصيل الجداول

### جدول users

| اسم العمود | نوع البيانات | الوصف |
|------------|--------------|-------|
| id | INT IDENTITY(1,1) | المفتاح الأساسي، يتم زيادته تلقائيًا |
| username | NVARCHAR(255) | اسم المستخدم، يجب أن يكون فريدًا |
| password | NVARCHAR(MAX) | كلمة المرور المشفرة باستخدام SHA-256 |
| is_admin | BIT | علامة تشير إلى ما إذا كان المستخدم مسؤولًا (1) أم لا (0) |

### جدول books

| اسم العمود | نوع البيانات | الوصف |
|------------|--------------|-------|
| id | INT IDENTITY(1,1) | المفتاح الأساسي، يتم زيادته تلقائيًا |
| title | NVARCHAR(255) | عنوان الكتاب |
| author | NVARCHAR(255) | اسم مؤلف الكتاب |
| price | FLOAT | سعر الكتاب |
| cover_url | NVARCHAR(512) | مسار صورة غلاف الكتاب (اختياري) |

### جدول cart

| اسم العمود | نوع البيانات | الوصف |
|------------|--------------|-------|
| id | INT IDENTITY(1,1) | المفتاح الأساسي، يتم زيادته تلقائيًا |
| user_id | INT | مفتاح خارجي يشير إلى معرف المستخدم في جدول users |
| book_id | INT | مفتاح خارجي يشير إلى معرف الكتاب في جدول books |

### جدول orders

| اسم العمود | نوع البيانات | الوصف |
|------------|--------------|-------|
| id | INT IDENTITY(1,1) | المفتاح الأساسي، يتم زيادته تلقائيًا |
| user_id | INT | مفتاح خارجي يشير إلى معرف المستخدم في جدول users |
| order_date | DATETIME | تاريخ ووقت إنشاء الطلب |
| total_amount | FLOAT | المبلغ الإجمالي للطلب |
| status | NVARCHAR(50) | حالة الطلب (مثل: قيد الانتظار، تم الشحن، تم التسليم، تم الإلغاء) |

### جدول order_items

| اسم العمود | نوع البيانات | الوصف |
|------------|--------------|-------|
| id | INT IDENTITY(1,1) | المفتاح الأساسي، يتم زيادته تلقائيًا |
| order_id | INT | مفتاح خارجي يشير إلى معرف الطلب في جدول orders |
| book_id | INT | مفتاح خارجي يشير إلى معرف الكتاب في جدول books |
| quantity | INT | كمية الكتاب المطلوبة |
| price | FLOAT | سعر الكتاب وقت الطلب (يتم تخزينه للاحتفاظ بالسعر التاريخي) |

## العلاقات

1. **علاقة بين users و cart**:
   - علاقة واحد إلى متعدد (One-to-Many)
   - مستخدم واحد يمكن أن يكون له عدة عناصر في سلة التسوق
   - يتم تنفيذ هذه العلاقة من خلال العمود user_id في جدول cart

2. **علاقة بين books و cart**:
   - علاقة واحد إلى متعدد (One-to-Many)
   - كتاب واحد يمكن أن يكون في عدة سلات تسوق
   - يتم تنفيذ هذه العلاقة من خلال العمود book_id في جدول cart

3. **علاقة بين users و orders**:
   - علاقة واحد إلى متعدد (One-to-Many)
   - مستخدم واحد يمكن أن يكون له عدة طلبات
   - يتم تنفيذ هذه العلاقة من خلال العمود user_id في جدول orders

4. **علاقة بين orders و order_items**:
   - علاقة واحد إلى متعدد (One-to-Many)
   - طلب واحد يمكن أن يحتوي على عدة عناصر
   - يتم تنفيذ هذه العلاقة من خلال العمود order_id في جدول order_items

5. **علاقة بين books و order_items**:
   - علاقة واحد إلى متعدد (One-to-Many)
   - كتاب واحد يمكن أن يكون في عدة طلبات
   - يتم تنفيذ هذه العلاقة من خلال العمود book_id في جدول order_items

## قيود المفاتيح الخارجية

- **user_id في جدول cart**:
  - مفتاح خارجي يشير إلى id في جدول users
  - يتم حذف عناصر سلة التسوق تلقائيًا عند حذف المستخدم (ON DELETE CASCADE)

- **book_id في جدول cart**:
  - مفتاح خارجي يشير إلى id في جدول books
  - يتم حذف عناصر سلة التسوق تلقائيًا عند حذف الكتاب (ON DELETE CASCADE)

- **user_id في جدول orders**:
  - مفتاح خارجي يشير إلى id في جدول users
  - يتم تعيين قيمة NULL عند حذف المستخدم (ON DELETE SET NULL)

- **order_id في جدول order_items**:
  - مفتاح خارجي يشير إلى id في جدول orders
  - يتم حذف عناصر الطلب تلقائيًا عند حذف الطلب (ON DELETE CASCADE)

- **book_id في جدول order_items**:
  - مفتاح خارجي يشير إلى id في جدول books
  - يتم الاحتفاظ بالعنصر حتى عند حذف الكتاب (ON DELETE NO ACTION)

## ملاحظات إضافية

- يتم استخدام SQL Server كنظام إدارة قواعد البيانات
- يتم إنشاء الجداول تلقائيًا عند بدء التطبيق إذا لم تكن موجودة
- يتم تعيين أول مستخدم يتم تسجيله كمسؤول (is_admin = 1)
- يتم تشفير كلمات المرور باستخدام خوارزمية SHA-256
